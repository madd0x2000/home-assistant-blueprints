blueprint:
  name: "Multi-Zone HVAC Control with Energy Price & Solar"
  description: "Control multiple HVAC zones based on temperature, electricity price, solar production and heat pump consumption"
  domain: automation
  input:
    # Global Sensors - Utan default värden
    solar_production_sensor:
      name: "Solar Production Sensor"
      description: "Välj sensor för solproduktion (t.ex. sensor.solax_now)"
      selector:
        entity:
          domain: sensor
          
    net_consumption_sensor:
      name: "Net Consumption Sensor" 
      description: "Välj sensor för nettoförbrukning (t.ex. sensor.remaining_power)"
      selector:
        entity:
          domain: sensor
          
    price_sensor:
      name: "Electricity Price Sensor"
      description: "Välj sensor för elpris med current_price attribut (t.ex. sensor.nordpool_kwh_se3_sek_0_00_025)"
      selector:
        entity:
          domain: sensor

    # Zone 1 Configuration
    zone1_temperature_sensor:
      name: "Zone 1 - Temperature Sensor"
      selector:
        entity:
          domain: sensor
          device_class: temperature
          
    zone1_hvac_entity:
      name: "Zone 1 - HVAC Entity"
      selector:
        entity:
          domain: climate
          
    zone1_heatpump_consumption_sensor:
      name: "Zone 1 - Heat Pump Consumption Sensor"
      selector:
        entity:
          domain: sensor

    zone1_target_temp_high:
      name: "Zone 1 - Target Temperature at Good Conditions"
      default: 22
      selector:
        number:
          min: 10
          max: 31
          step: 0.5
          unit_of_measurement: "°C"
          
    zone1_target_temp_low:
      name: "Zone 1 - Target Temperature at Poor Conditions"
      default: 20
      selector:
        number:
          min: 10
          max: 31
          step: 0.5
          unit_of_measurement: "°C"

    # Zone 2 Configuration
    zone2_temperature_sensor:
      name: "Zone 2 - Temperature Sensor"
      selector:
        entity:
          domain: sensor
          device_class: temperature
          
    zone2_hvac_entity:
      name: "Zone 2 - HVAC Entity"
      selector:
        entity:
          domain: climate
          
    zone2_heatpump_consumption_sensor:
      name: "Zone 2 - Heat Pump Consumption Sensor"
      selector:
        entity:
          domain: sensor

    zone2_target_temp_high:
      name: "Zone 2 - Target Temperature at Good Conditions"
      default: 22
      selector:
        number:
          min: 10
          max: 31
          step: 0.5
          unit_of_measurement: "°C"
          
    zone2_target_temp_low:
      name: "Zone 2 - Target Temperature at Poor Conditions"
      default: 20
      selector:
        number:
          min: 10
          max: 31
          step: 0.5
          unit_of_measurement: "°C"

    # Night Mode Settings
    night_mode_start:
      name: "Night Mode Start Time"
      default: "00:00:00"
      selector:
        time: {}

    night_mode_end:
      name: "Night Mode End Time"
      default: "05:00:00"
      selector:
        time: {}

    zone1_night_temperature:
      name: "Zone 1 - Night Temperature"
      default: 18
      selector:
        number:
          min: 10
          max: 25
          step: 0.5
          unit_of_measurement: "°C"

    zone2_night_temperature:
      name: "Zone 2 - Night Temperature"
      default: 18
      selector:
        number:
          min: 10
          max: 25
          step: 0.5
          unit_of_measurement: "°C"

    # Global Settings
    base_consumption:
      name: "Base Household Consumption (W)"
      default: 400
      selector:
        number:
          min: 0
          max: 1000
          step: 10
          unit_of_measurement: "W"

    temperature_boost:
      name: "Temperature Boost for Heating (°C)"
      default: 1.0
      selector:
        number:
          min: 0.5
          max: 3.0
          step: 0.5
          unit_of_measurement: "°C"

    # Global Thresholds
    solar_threshold:
      name: "Solar Production Threshold (W)"
      default: 300
      selector:
        number:
          min: 0
          max: 5000
          unit_of_measurement: "W"
          
    export_threshold:
      name: "Energy Export Threshold (W)"
      default: -500
      selector:
        number:
          min: -5000
          max: 0
          unit_of_measurement: "W"
          
    price_threshold:
      name: "Electricity Price Threshold (öre/kWh)"
      default: 50
      selector:
        number:
          min: 0
          max: 500
          unit_of_measurement: "öre/kWh"

    heatpump_threshold:
      name: "Heat Pump Consumption Threshold (W)"
      default: 800
      selector:
        number:
          min: 0
          max: 3000
          unit_of_measurement: "W"

    # Fan Settings
    normal_fan_mode:
      name: "Normal Fan Mode"
      default: "auto"
      selector:
        select:
          options:
            - label: "Auto"
              value: "auto"
            - label: "1 - Very Low"
              value: "1"
            - label: "2 - Low"
              value: "2"
            - label: "3 - Medium"
              value: "3"
            - label: "4 - High"
              value: "4"
            - label: "5 - Very High"
              value: "5"

    boost_fan_mode:
      name: "Boost Fan Mode when Cold"
      default: "4"
      selector:
        select:
          options:
            - label: "3 - Medium"
              value: "3"
            - label: "4 - High"
              value: "4"
            - label: "5 - Very High"
              value: "5"

    temp_difference:
      name: "Temperature Difference for Activation"
      default: 1.0
      selector:
        number:
          min: 0.5
          max: 3.0
          step: 0.5
          unit_of_measurement: "°C"

    boost_temp_difference:
      name: "Temperature Difference for Boost Mode"
      default: 2.0
      selector:
        number:
          min: 1.0
          max: 5.0
          step: 0.5
          unit_of_measurement: "°C"

variables:
  # Felsäkra sensor-referenser
  solar_production: >
    {% if solar_production_sensor and states(solar_production_sensor) != 'unknown' and states(solar_production_sensor) != 'unavailable' %}
      {{ states(solar_production_sensor) | float(0) }}
    {% else %}
      0
    {% endif %}
  
  net_consumption: >
    {% if net_consumption_sensor and states(net_consumption_sensor) != 'unknown' and states(net_consumption_sensor) != 'unavailable' %}
      {{ states(net_consumption_sensor) | float(0) }}
    {% else %}
      0
    {% endif %}
  
  electricity_price: >
    {% if price_sensor and states(price_sensor) != 'unknown' and states(price_sensor) != 'unavailable' %}
      {{ state_attr(price_sensor, 'current_price') | float(100) }}
    {% else %}
      100
    {% endif %}
  
  base_consumption: "{{ base_consumption | float }}"
  temperature_boost: "{{ temperature_boost | float }}"
  
  is_night_mode: >
    {% set now = now().strftime('%H:%M:%S') %}
    {% set start = night_mode_start %}
    {% set end = night_mode_end %}
    {{ (now >= start and now <= end) or (start > end and (now >= start or now <= end)) }}

# ... resten av blueprinten oförändrad ...
